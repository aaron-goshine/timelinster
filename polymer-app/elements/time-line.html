<link rel="import" href="/polymer-app/bower_components/polymer/polymer.html">
<link rel="import" href="/polymer-app/bower_components/iron-ajax/iron-ajax.html">

<dom-module id="time-line" attributes="url">
  <template>
    <style>
    .component * {
        font-family: Helvetica;
    }

    .component {
        padding-top: 2em;
        height: 2em;
    }

    .time-line {
        height: 2em;
        position: relative;
    }

    .bars {
        height: inherit;
        position: absolute;
        background-color: #ECECEC;
        width: 100%;
        top: 0;
        left: 0;
    }
    .ticks {
        background-color: black;
        position: inherit;
        height: inherit;
        width: 5px;
    }

    .event-deltas {
        position: inherit;
        height: inherit;
        background-color: #94BF21;
        text-align: center;
        line-height: 2em;
    }

    .ticks label {
        top: -1.5em;
        position: inherit;
    }

    #bars div:last-child {
      background: pink;
      width: 20px;
      height: 20px;
        left: -3em;
    }
  </style>

  <iron-ajax auto url="{{url}}" handle-as="json" last-response="{{ajaxResponse}}" ></iron-ajax>

  <div class="component">
      <div class="time-line">
        <div id="bars" class="bars">
          <template is="dom-repeat" items="[[ajaxResponse.schedule]]">
            <div class="event-deltas" style$="[[getEventStyle(item)]]" >
            </div>
          </template>
          <template is="dom-repeat" items="[[ajaxResponse.ticks]]">
            <div class="ticks" style$="[[getTickStyle(item)]]">
              <label>[[formatter(item)]]</label>
            </div>
          </template>
        </div>
      </div>
    </div>
  </template>
  <script src="/js-timeline-functions/timeline-functions.js"></script>
  <script >
    Polymer({
      is: 'time-line',
      ready: function (event) {
        console.log('ready');
      },
      responseCallback: function () {
          console.log ('callback');
      },
      getSpan: function (from, to) {
       return timelineFns.eventSpan(from, to);
      },
      getTimeLinePosition: function (from, to) {
       return timelineFns.eventSpan(from, to);
      },
      formatter: function (value) {
        return timelineFns.labelFormat(value);
      },
      getEventStyle: function (event) {
        var styleObj = timelineFns.generateEventStyle(event);
        var style = '';
        for (props in styleObj) {
          style += String(props + ':' + styleObj[props]) + ';';
        }
        return style; 
      },
      getTickStyle: function (value) {
        var styleObj = timelineFns.generateTickStyle(value);
        var style = '';
        for (props in styleObj) {
          style += String(props + ':' + styleObj[props]) + ';';
        }
        return style; 
      }
    });
  </script>
</polymer-element>
